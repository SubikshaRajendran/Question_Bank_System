<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - Question Bank System</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <nav>
        <div class="logo">QB System</div>
        <ul>
            <li><a href="index.html">Home</a></li>
        </ul>
    </nav>

    <div class="container" style="max-width: 400px; margin-top: 4rem;">
        <div class="card">
            <h2 style="text-align: center; margin-bottom: 1.5rem;">Admin Login</h2>
            <form id="adminLoginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required placeholder="Enter admin email">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="password-wrapper">
                        <input type="password" id="password" required placeholder="Enter password">
                        <button type="button" class="password-toggle" id="togglePassword" title="Show Password">
                            <!-- Eye Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="eye-open">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            <!-- Eye Off Icon (hidden by default logic) -->
                        </button>
                    </div>
                </div>

                <!-- Hidden Error Message Container -->
                <div id="adminError" class="error-message"
                    style="display: none; color: var(--danger); margin-bottom: 1rem; text-align: center; font-weight: 500;">
                    Invalid Admin Credentials
                </div>

                <button type="submit" class="btn" style="width: 100%;" id="loginBtn">Login</button>
            </form>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        // Password Toggle Logic
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');

        togglePassword.addEventListener('click', function () {
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            // Optional: Toggle icon style (simple opacity change or icon swap could continue here)
            this.style.color = type === 'text' ? 'var(--primary-color)' : 'var(--text-secondary)';
        });

        document.getElementById('adminLoginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            const errorDiv = document.getElementById('adminError');
            const card = document.querySelector('.card');

            // Reset UI
            errorDiv.style.display = 'none';
            card.classList.remove('shake');
            loginBtn.textContent = 'Logging in...';
            loginBtn.disabled = true;

            try {
                const res = await login('/api/auth/admin/login', email, password);

                if (res.success) {
                    localStorage.setItem('role', 'admin');
                    window.location.href = 'admin_dashboard.html';
                } else {
                    throw new Error(res.message || 'Invalid credentials');
                }
            } catch (err) {
                // Show Error
                console.error(err);
                if (err.message.includes('401') || !err.success) {
                    errorDiv.textContent = "Invalid Admin Credentials";
                } else {
                    errorDiv.textContent = err.message || "Login failed. Please try again.";
                }
                errorDiv.style.display = 'block';

                // Shake Effect
                card.classList.add('shake');
                setTimeout(() => card.classList.remove('shake'), 500);

                // Reset Button
                loginBtn.textContent = 'Login';
                loginBtn.disabled = false;
            }
        });
    </script>
</body>

</html>